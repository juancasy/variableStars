---
title: "Experiment on HD174936 and HD 174966"
author: "Roberto Maestre"
date: "10/24/2018"
output: github_document
---

```{r setup, include=FALSE}
library(variableStars)
library(data.table)
library(ggplot2)
library(microbenchmark)
```


## Experiment configuration

#### Data source

Data gathering from the Antonio's PhD thesis.

- HD174936: table1.dat, ftp://cdsarc.u-strasbg.fr/pub/cats/J/A+A/506/79/ReadMe
- HD174966: freqs.dat, ftp://cdsarc.u-strasbg.fr/pub/cats/J/A+A/559/A63/ReadMe


```{r dataSource}
if (T) {
  dt <- data.frame(read.table("../data/table1.dat", sep = "\t"))
  colnames(dt) <- c("Seq","frequency","amplitude","Phase","Sig","S/N","rms","e_Freq","e_Amp","e_Phase")
} else {
  dt <- data.frame(read.table("../data/freqs.dat", sep = " "))
  colnames(dt) <- c("Id","frequency","Freq2","amplitude","Phase","Sig", "S/N","rms", "e_Freq1","e_Amp","e_Phase")
}
head(dt)

# Save Data to disk (to be replicated)
write.table(
  dt[c("frequency", "amplitude")],
  file = "/tmp/data.csv",
  sep = "\t",
  quote = F,
  row.names = F,
  col.names = F
)
```

#### Frequences and Amplitudes 

```{r freqAmp}
plot_spectrum(-10, 90, dt)
```

##  Experiment execution

process is the main method on the variableStars package to compute and estimate all parameters

```{r calculate, warning=F}
result <- process(
  dt$frequency,
  dt$amplitude,
  filter = "uniform",
  gRegimen = 0,
  minDnu = 15,
  maxDnu = 95,
  dnuValue = -1,
  dnuGuessError = 10,
  dnuEstimation = TRUE,
  numFrequencies = 30,
  debug = TRUE
)
```

#### Apodization


```{r apodization, warning=F}
# Plot frecuency and amplitude
ggplot(
  aes(x = frequences, y = amplitude),
  data = data.frame(
    "frequences" = result$ft$frequences,
    "amplitude" = result$ft$amp
  )
) +
  geom_point() +
  geom_line() +
  ggtitle("Apodization- Frequences and amplitudes") +
  theme_bw()
```


#### FT - Power Spectrum

```{r ftPower, warning=F}
# Plot frecuency and amplitude
dt <-
  data.frame("f_inv" = result$ft$f_inv,
             "powerSpectrum" = result$ft$powerSpectrum)
ggplot(aes(x = f_inv, y = powerSpectrum), data = dt) +
  geom_point(alpha=0.2) +
  geom_line(alpha=0.2) +
  ggtitle("FT - Power Spectrum") +
  theme_bw()
```


####  Histogram fo differences. 

We show the complete histogram

```{r diffsHistogram, warning=F}
dt <- data.frame(result$diffHistogram$histogram)
ggplot(aes(x = bins, y = values), data = dt) +
  geom_bar(stat = "identity") +
  ggtitle("Histogram of differences") +
  theme_bw()
```


####  Cross correlation

Simple cross correlation

```{r crossCorrelation, warning=F}
cc <- result$crossCorrelation
dt <- data.frame("lag" = seq(round(-1*(length(cc)-1)/2), round((length(cc)-1)/2)), 
                 "cc"=cc)
ggplot(aes(x = lag, y = cc), data = dt) +
  geom_bar(stat = "identity") +
  ggtitle("Cross correlation") +
  theme_bw()
```




